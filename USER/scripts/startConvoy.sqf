params ["_isNorth"];

private _pointsNorth = [[5962.1,10921.8,-0.0482841],[5966.35,10922.7,-0.049542],[5973.52,10924.3,-0.0369558],[5982.11,10926.2,-0.0491095],[5990.95,10928.2,-0.0468092],[5998.76,10929.8,-0.0348988],[6007.61,10931.8,-0.0323277],[6016.37,10933.7,-0.0547028],[6025.12,10935.6,-0.0389333],[6033.88,10937.6,-0.0505257],[6042.72,10939.5,-0.0461917],[6051.38,10941.4,-0.0323491],[6060.06,10943.3,-0.0375757],[6068.81,10945.2,-0.0585036],[6077.52,10947.1,-0.0520997],[6086.49,10949.2,-0.0467472],[6094.93,10950.9,-0.0466294],[6104,10952.6,-0.0405164],[6112.5,10954.1,-0.0538082],[6121.51,10955.7,-0.0477576],[6130.13,10957.4,-0.0326023],[6139.07,10959,-0.0418444],[6147.69,10960.5,-0.0459232],[6156.69,10961.8,-0.0321712],[6165.71,10963.1,-0.0499325],[6174.33,10964.5,-0.043458],[6183.32,10965.9,-0.0389175],[6192.1,10967.2,-0.0217457],[6200.77,10968.5,-0.065114],[6209.74,10969.6,0.0160742],[6218.5,10970.2,-0.0138407],[6227.34,10970.6,-0.0563183],[6236.32,10970.5,-0.0310774],[6245.35,10969.9,-0.0407124],[6254.08,10969,-0.0399761],[6262.88,10967.6,-0.0381527],[6271.52,10965.7,-0.0340786],[6280.14,10963.4,-0.0287733],[6288.68,10960.6,-0.0423069],[6297.08,10956.8,-0.0496292],[6304.82,10952.7,-0.0400381],[6312.52,10948.4,-0.0408411],[6320.28,10943.9,-0.0249767],[6327.83,10939.2,-0.0330162],[6335.25,10934.3,-0.0263615],[6342.44,10929.1,-0.0328541],[6349.41,10923.6,-0.0422993],[6356.35,10917.8,-0.0337372],[6362.65,10911.8,-0.0410919],[6368.79,10905,-0.0382175],[6373.91,10897.8,-0.0288715],[6378.39,10890.2,-0.0126076],[6381.83,10882,-0.0231247],[6384.52,10873.6,-0.0234528],[6386.97,10865,-0.0168552],[6389.38,10856.6,-0.0164013],[6391.81,10848,-0.0191841],[6394.27,10839.4,-0.0100365],[6396.67,10831,-0.0198936],[6399.05,10822.5,-0.00805092],[6401.4,10814.1,0.00148964],[6403.88,10805.2,-0.00854301],[6406.19,10796.7,-0.0338936],[6408.09,10788.1,-0.0419121],[6409.95,10779.3,-0.033886],[6411.79,10770.6,-0.0296497],[6413.63,10761.9,-0.0266953],[6415.44,10753.3,-0.0355949],[6417.26,10744.7,-0.0300598],[6419.36,10736,-0.0322647],[6421.68,10727.3,-0.0248756],[6424.18,10718.9,-0.032795],[6427.2,10710.6,-0.0155792],[6430.76,10702.6,-0.0305367],[6434.61,10694.6,-0.0282288],[6438.85,10686.5,-0.0138435],[6443.5,10679.1,-0.016983],[6448.84,10672,-0.0178795],[6454.77,10665.3,-0.0142937],[6461.16,10659.2,-0.0205116],[6467.78,10653.3,-0.0288849],[6474.4,10647.4,-0.0311508],[6481.04,10641.6,-0.0237846],[6488.18,10636.1,-0.0328712],[6495.56,10631.1,-0.0374298],[6503.05,10626.5,-0.0372887],[6511.06,10622.3,-0.0298843],[6519.22,10618.8,-0.0218239],[6527.75,10616.2,-0.00797272],[6536.24,10614.4,-0.0316811],[6545.01,10612.8,-0.0338211],[6553.94,10611.1,-0.0412636],[6562.85,10609.4,-0.0388451],[6571.32,10607.8,-0.0403099],[6580.07,10606.2,-0.0420647],[6588.79,10604.5,-0.0362244],[6597.63,10603.1,-0.0183754],[6606.42,10601.5,-0.0359612],[6614.99,10599.7,-0.0259323],[6623.72,10597.3,-0.0382996],[6632.05,10594.2,-0.0359077],[6640.16,10590.6,-0.0294456],[6648.39,10586.7,-0.0267143],[6656.28,10583,-0.0329933],[6663.99,10578.7,-0.0264854],[6671.51,10573.7,-0.0246658],[6678.84,10568.7,-0.0197945],[6686.24,10563.8,-0.0258789],[6693.74,10559,-0.0297585],[6701.34,10554.5,-0.0293274],[6709.2,10550.2,-0.0412788],[6716.81,10546,-0.0292549],[6724.55,10541.7,-0.0275955],[6732.68,10537.3,-0.0232048],[6740.41,10533.1,-0.0246429],[6748.24,10528.8,-0.0362549],[6755.98,10524.9,-0.022934],[6764.12,10521.1,-0.0166702],[6772.1,10517.5,-0.00804138],[6780.6,10514.1,-0.00621796],[6788.82,10511.1,-0.023941],[6797.39,10508.6,-0.0212784],[6806.01,10506.8,-0.0129471],[6814.73,10505.7,-0.0190353],[6823.53,10505.6,-0.0234833],[6832.61,10506.5,-0.0350037],[6841.3,10508.1,-0.0334091],[6849.72,10510.5,-0.0249329],[6857.56,10514.4,-0.00622559],[6864.67,10519.9,0.00670624],[6870.45,10526.8,0.0367355],[6874.84,10534.1,0.0299454],[6878.87,10542.2,-0.0100174],[6882.84,10550.2,-0.0294189],[6886.9,10558.2,-0.0454559],[6890.92,10566.1,-0.0509567],[6895.02,10574.1,-0.0449142],[6899.04,10582,-0.0514221],[6902.89,10589.9,-0.0551376],[6906.48,10598,-0.0387802],[6910.34,10606.3,-0.0324478],[6914.13,10614.5,-0.0522461],[6917.91,10622.6,-0.0542603],[6921.98,10630.6,-0.0525589],[6926.17,10638.4,-0.054863],[6930.63,10646,-0.0430603],[6936.04,10653.3,-0.0436707],[6941.94,10660.1,-0.0400543],[6948.66,10665.9,-0.029808],[6956.67,10670,-0.0536118],[6964.91,10672.6,-0.00630951],[6973.98,10673.6,-0.0214462],[6982.54,10673.7,-0.0010376],[6991.39,10673.7,0.0046463],[7000.54,10673.5,0.0018158],[7009.42,10673.3,-0.0106583],[7018.14,10672.9,-0.0116959],[7026.92,10672.6,-0.0109711],[7035.88,10672.3,0.00643158],[7044.46,10672,0.0157242],[7053.31,10671.8,0.0259171],[7062.32,10671.3,0.0227127],[7071.09,10670.7,0.0207825],[7079.71,10670.2,0.0252762],[7088.45,10669.6,0.0083313],[7097.25,10669,0.0106888],[7106.06,10668.4,0.0121536],[7114.79,10667.8,0.00828552],[7123.72,10667.2,-0.00645447],[7132.58,10666.6,-0.0212097],[7141.39,10666.1,-0.0194473],[7150.27,10665.6,-0.0274506],[7159.17,10665.2,-0.0299377],[7168.23,10665,-0.0241013],[7177.27,10664.6,-0.0290985],[7185.81,10664.1,-0.0431824],[7195.05,10663.6,-0.0386353],[7203.81,10663.1,-0.0468063],[7213.11,10662.7,-0.0535965],[7221.87,10662.2,-0.0445023],[7230.6,10661.9,-0.0386734],[7239.88,10661.5,-0.0353928],[7248.74,10661.1,-0.0303116],[7257.81,10660.6,-0.0546036],[7266.8,10660.2,-0.0466843],[7275.56,10659.8,-0.0511017],[7284.54,10659.4,-0.0302124],[7293.61,10659.2,-0.0458374],[7302.68,10658.9,-0.0365372],[7311.8,10658.6,-0.0408936],[7320.81,10658.1,-0.0357895],[7329.59,10657.6,-0.0137253],[7338.44,10657.2,-0.0116119],[7347.51,10656.9,-0.0143127],[7356.52,10656.5,-0.0246735],[7365.5,10655.9,-0.047699],[7374.77,10655.3,-0.0272675],[7383.5,10654.6,-0.0297775],[7392.42,10653.9,-0.02668],[7401.35,10652.8,-0.0197678],[7410.35,10651.4,-0.0396194]];

private _pointsSouth = [[5403.93,9880.18,-0.0527439],[5399.86,9880.37,-0.054502],[5393.49,9880.66,-0.0524206],[5384.37,9881.1,-0.051095],[5375.45,9881.56,-0.0513973],[5366.45,9882.02,-0.0512767],[5357.2,9882.47,-0.051157],[5348.2,9882.91,-0.0512137],[5339.06,9883.34,-0.0546918],[5330,9883.82,-0.0551395],[5321.13,9884.27,-0.0469599],[5311.96,9884.74,-0.0495725],[5302.99,9885.21,-0.042325],[5293.84,9885.69,-0.0507941],[5284.69,9886.16,-0.0527692],[5275.55,9886.63,-0.0544066],[5266.66,9887.02,-0.0473666],[5258.45,9887.36,-0.0554824],[5249.15,9887.8,-0.0457106],[5240.17,9888.28,-0.0502887],[5231.2,9888.74,-0.0519891],[5221.92,9889.21,-0.0510826],[5213.03,9889.91,-0.0461497],[5204.07,9890.74,-0.0527911],[5195.05,9891.66,-0.0498962],[5186.12,9892.69,-0.0574369],[5176.91,9893.84,-0.0494556],[5167.91,9894.9,-0.0486321],[5158.96,9895.81,-0.0442843],[5150.07,9896.03,-0.0447798],[5141.05,9895.32,-0.0491366],[5132.11,9893.43,-0.0454631],[5123.34,9890.65,-0.0409408],[5115.47,9886.5,-0.0446196],[5108.09,9881.13,-0.0418925],[5101.25,9875.42,-0.0505629],[5094.14,9869.33,-0.0396795],[5087.72,9863.34,-0.0595703],[5081.76,9856.14,-0.0343523],[5077.57,9848.32,-0.0401754],[5075,9839.71,-0.0380735],[5073.79,9830.66,-0.0383835],[5073.02,9821.71,-0.0460844],[5071.87,9812.5,-0.0426617],[5069.94,9803.76,-0.0431633],[5067.24,9795.14,-0.0480452],[5064.36,9786.71,-0.0523062],[5061.33,9777.94,-0.0517464],[5057.62,9769.72,-0.0464916],[5052.97,9761.97,-0.0434008],[5047.87,9754.89,-0.0491123],[5041.76,9747.82,-0.0392132],[5035.35,9741.66,-0.051403],[5028.63,9735.49,-0.0413771],[5021.99,9729.32,-0.0476065],[5015.34,9723.07,-0.0512152],[5008.81,9716.81,-0.0427847],[5002.54,9710.62,-0.0426149],[4996.06,9704.21,-0.047617],[4989.3,9697.88,-0.0490446],[4982.75,9691.83,-0.0502758],[4976.56,9685.45,-0.0394611],[4970.33,9678.89,-0.0486031],[4963.89,9672.22,-0.0492926],[4957.73,9665.8,-0.0525093],[4951.39,9659.15,-0.0503063],[4945.14,9652.61,-0.0453472],[4939.08,9646.25,-0.0440226],[4932.66,9639.5,-0.046751],[4926.5,9633.01,-0.0482435],[4920.32,9626.52,-0.0447969],[4914.13,9620.02,-0.0458012],[4907.85,9613.41,-0.0513144],[4901.67,9606.93,-0.0546417],[4895.33,9600.27,-0.0521154],[4889.07,9593.88,-0.0502462],[4882.72,9587.44,-0.0538025],[4876.43,9581.08,-0.0593233],[4869.93,9574.49,-0.0456829],[4863.68,9568.15,-0.0510168],[4857.44,9561.82,-0.0499096],[4850.95,9555.24,-0.0640879],[4844.72,9548.91,-0.0472069],[4838.21,9542.33,-0.0496092],[4831.96,9536,-0.0439215],[4825.6,9529.6,-0.0493126],[4818.94,9523.45,-0.0390606],[4812.3,9517.41,-0.0448122],[4805.53,9511.27,-0.0511513],[4798.95,9505.28,-0.03936],[4792.24,9499.19,-0.0494442],[4785.54,9493.11,-0.0559711],[4778.85,9486.97,-0.0407867],[4772.19,9480.44,-0.049365],[4766.43,9473.48,-0.0387125],[4761.4,9466.24,-0.0527382],[4756.68,9458.37,-0.0409241],[4752.92,9450.15,-0.040349],[4750.37,9441.55,-0.0363998],[4749.44,9432.63,-0.0367746],[4749.5,9423.37,-0.0538006],[4749.81,9414.58,-0.0458851],[4750.7,9405.58,-0.0418739],[4751.85,9396.53,-0.0411539],[4752.74,9387.46,-0.0476017],[4752.66,9378.66,-0.0521336],[4751.8,9369.62,-0.0426846],[4749.85,9360.66,-0.051527],[4747.03,9352.07,-0.0410891],[4743.54,9343.83,-0.0533371],[4739.98,9335.59,-0.04566],[4736.12,9327.24,-0.0408378],[4732.39,9319.23,-0.0430298],[4728.47,9310.9,-0.0401917],[4724.51,9302.78,-0.0449181],[4720.52,9294.57,-0.0429816],[4716.63,9286.42,-0.0531602],[4712.81,9278.23,-0.0448236],[4709.09,9270.24,-0.0414991],[4705.16,9261.79,-0.0499053],[4701.37,9253.68,-0.0545282],[4697.55,9245.49,-0.0498381],[4693.8,9237.45,-0.0420341],[4690,9229.26,-0.0552826],[4686.13,9220.94,-0.054338],[4682.41,9212.87,-0.0413437],[4678.57,9204.54,-0.0405574],[4674.81,9196.39,-0.0427995],[4671.06,9188.35,-0.0528593],[4666.97,9180.23,-0.0406837],[4662.73,9172.03,-0.0482044],[4658.57,9164.08,-0.0385199],[4654.28,9156.23,-0.0417914],[4650.02,9148.27,-0.0377102],[4645.57,9140.32,-0.0492668],[4641.23,9132.51,-0.0576682],[4636.81,9124.57,-0.0468884],[4632.5,9116.84,-0.0565228],[4628.02,9108.83,-0.049932],[4623.47,9100.95,-0.0468273],[4618.86,9093.43,-0.0423441],[4613.88,9085.92,-0.04566],[4608.68,9078.32,-0.0414944],[4603.42,9070.9,-0.0488877],[4598.1,9063.81,-0.0509377],[4592.51,9056.63,-0.0498476],[4586.77,9049.76,-0.0413814],[4580.93,9042.87,-0.0621524],[4575.05,9035.92,-0.0555182],[4569.16,9028.98,-0.0468764],[4563.48,9022.17,-0.0553164],[4557.6,9015.55,-0.0366511],[4551.41,9008.77,-0.0537319],[4545.18,9002.22,-0.0194025],[4538.81,8995.88,-0.0253825],[4531.91,8989.81,-0.0461082],[4525.19,8984.12,-0.0567517],[4518.21,8978.25,-0.0451198],[4511.21,8972.55,-0.0251541],[4504.19,8966.98,-0.0405636],[4496.8,8961.64,-0.0573478],[4489.3,8956.23,-0.0478249],[4482.33,8950.96,-0.0471792],[4475.12,8945.28,-0.0498438],[4468.34,8939.44,-0.0489635],[4461.73,8933.28,-0.0494466],[4455.39,8926.86,-0.0401521],[4449.41,8920.03,-0.0474315],[4443.92,8912.85,-0.0382037],[4438.91,8905.34,-0.0465322],[4434.27,8897.49,-0.0517859],[4429.79,8889.72,-0.0436888],[4425.64,8881.78,-0.0478525],[4421.5,8873.64,-0.0419903],[4416.87,8865.92,-0.0392714],[4411.29,8858.87,-0.0461144],[4405.04,8853.11,-0.0548697],[4398.41,8847.56,-0.0498681],[4391.81,8841.99,-0.0420985],[4385.09,8835.93,-0.0334258],[4378.85,8829.91,-0.0533819],[4373.24,8823.54,-0.0533118],[4369.58,8816.27,-0.0517387],[4368.99,8808.11,-0.0507274],[4370.46,8800.47,-0.0540047],[4372.3,8792.66,-0.0539765],[4374.92,8785.69,-0.0556822],[4377.62,8779.68,-0.0536375],[4381.08,8773.58,-0.0540729],[4385.02,8767.89,-0.0521188],[4389.46,8763.23,-0.0549083],[4394.56,8759.09,-0.0535822],[4400.84,8755.6,-0.0536156],[4407.24,8753.28,-0.0501447],[4413.31,8752.26,-0.0549035],[4419.98,8752.03,-0.0525603],[4427.16,8752.8,-0.0551009],[4435.3,8754.05,-0.0499868],[4444.08,8755.9,-0.0601349],[4452.64,8757.96,-0.0550842],[4461.04,8760.23,-0.0529175],[4469.4,8762.81,-0.0497403],[4478.03,8765.66,-0.0521841],[4486.46,8768.54,-0.0493131],[4494.96,8771.52,-0.0476813],[4503.14,8774.59,-0.0482335],[4511.83,8777.87,-0.0491886],[4520.05,8781.2,-0.0510759],[4528.76,8784.49,-0.0485444],[4537,8787.5,-0.0530577],[4545.75,8790.7,-0.0449433],[4554.31,8793.89,-0.0367279],[4562.42,8797.25,-0.0530591],[4570.82,8800.74,-0.0515943],[4579.45,8804.16,-0.0504746],[4587.86,8807.47,-0.05335],[4596.19,8810.74,-0.0508695],[4604.75,8814.2,-0.0439954],[4612.93,8817.67,-0.0474172],[4621.54,8821.17,-0.0403848],[4629.88,8824.16,-0.0497475],[4638.04,8827.08,-0.0508013]];

private _startedVarName = ["orp_convoySouthStarted","orp_convoyNorthStarted"] select _isNorth;
missionNamespace setVariable [_startedVarName,true,true];

private _points = [_pointsSouth,_pointsNorth] select _isNorth;

private _convoyNorth = [orp_convoyNorthVeh1,orp_convoyNorthVeh2,orp_transporter,orp_convoyNorthVeh3,orp_convoyNorthVeh4];
private _convoySouth = [orp_convoySouthVeh1,orp_convoySouthVeh2,orp_transporter_fake,orp_convoySouthVeh3,orp_convoySouthVeh4];

private _convoy = [_convoySouth,_convoyNorth] select _isNorth;
(_convoy select 0) setDriveOnPath _points;

for [{_i=0},{_i<count _convoy},{_i=_i+1}] do {
    [{
        params ["_vehicles","_handle"];
        _vehicles params ["_leader","_thisVeh","_follower","_vehicle1"];

        if (isNull (driver _vehicle1) && {speed _thisVeh < 1}) exitWith {
            [_handle] call CBA_fnc_removePerFrameHandler;
        };

        private _distFront = _thisVeh distance _leader;
        private _distBack = _thisVeh distance _follower;

        if (!isNull _leader) then {
            if (_distFront < 5) then {
                _thisVeh limitSpeed 0.5;
            } else {
                _thisVeh setDriveOnPath [getPos _thisVeh,_thisVeh getPos [0.8 * _distFront,_thisVeh getDir _leader]];
                private _speedLimit = if (_distFront > 15) then {if (_distFront < 20) then {30} else {34}} else {26};
                _thisVeh limitSpeed _speedLimit;
            };
        };

        if (!isNull _follower && {_distBack > 50}) then {
            _thisVeh limitSpeed 0.5;
        } else {
            if (isNull _leader) then {
                _thisVeh limitSpeed 30;
            };
        };

    },0.5,[_convoy param [_i-1,objNull],_convoy select _i,_convoy param [_i+1,objNull]],_convoy select 0] call CBA_fnc_addPerFrameHandler;
};
